
> 本文翻译自：https://hackernoon.com/a-beginners-ultimate-guide-to-dags-7fc0dd7f39a2
>
> 译者：[区块链中文字幕组](https://github.com/BlockchainTranslator/EOS) [小丹](https://github.com/zhuangjun)
>
> 翻译时间：2018-10-26

----------------------------------------------------


这篇文章的目的是清楚地理解DAG背后的想法。

在深层次上充分理解它的最好方法是通过推理来学习为什么事情就是这样。因此，我们将从一个非常基本的DAG开始，然后尝试通过逻辑上以有意义的方式引入更复杂的东西来构建健壮且安全的DAG网络。

在本教程中，我们将看到IOTA的纠结是如何工作的。

### **_有向图_**

为了理解Tangle，我们需要了解计算机科学家所谓的[** _有向图_ **][1]。有向图是定点（正方形）的集合，它们通过变（箭头）相互连接。这是有向图的示例：

![][3]

一个简单的DAG

Tangle是IOTA背后的数据结构，是一种特殊的有向图，它包含交易。每个交易都表示为图中的顶点。当新交易加入Tangle时，它会选择两个先前的交易来证明，向图中添加两个新边。在上面的示例中，交易编号5批准了交易编号2和3.交易或多或少是您所期望的，表格“人A给了人B十个IOTA”的信息。在这个阶段，我们不会过多担心批准交易的含义，因为我们稍后会讨论这个问题。

我们称未经批准的交易为tips。在该示例中，交易号6是一个tip，因为还没有人批准它。每个收到的交易都需要选择两个批准的tip（总有至少一个！）。选择哪两个tip是非常重要的策略，是IOTA独特技术的关键。但是，为了让我们的生活更轻松，我们将从最简单的策略开始：在所有可用提示之间随机选择。每个传入的交易查看所有当前未批准的交易，并且只是随机选择两个。

当每个人都使用这种随机选择策略（技术上称为“统一随机提示选择”）时，为了看看tangle是什么样的，你可以玩这个[**视觉模拟**][4]。此模拟生成随机tangle，左侧是第一个交易（称为创世交易），右侧是最近的交易。尖端标有灰色方块。当您将鼠标悬停在某个交易上时，它所批准的所有交易都会以红色突出显示，而所有批准它的交易都会变为蓝色。

![][7]

### 交易率和网络延迟

在之前的模拟中，您可能已经注意到交易并非在时间上均匀分布，但某些时段比其他时段“更加繁忙”。通过使用[**泊松点过程**][8]来模拟交易如何到达，这种随机性使模型更加真实。此模型非常常见，用于分析在给定时间段内有多少客户走进商店，或拨打多少电话到呼叫中心。我们可以在下面的示例中看到这种行为。交易4,5和6几乎同时到达，并且在交易6之后有一个长时间的停顿。

![][10]

出于我们的目的，我们只需要知道关于这个泊松点过程的一件事：平均来说，传入交易的速率是恒定的，并且由我们称为λ的数字设置。例如，如果我们设置λ= 2，并且交易数量为100，则总模拟时间将是大约50个时间单位。 [尝试一下][11]！

在继续之前要指出的另一个有趣的事情是：如果我们将λ设置为非常小的量（比如0.1），我们就会得到一个“链”。链是一个tangle，交易只批准一个先前的交易，而不是两个。发生这种情况是因为交易进展缓慢，以至于在任何给定时间只有一个提示需要批准。这就是区块链中实际发生的事情。因此，DAG基本上是区块链的一般形式。在另一个极端情况下，对于巨大的λ，所有交易都到达如此之快，以至于他们看到的唯一提示是起源。这只是模拟的一个限制：对于大的λ和固定数量的交易，我们模拟的时间非常短。

![][13]

_很小的λ产生的链_

![][15]

_非常大的λ：只有起源可见_

那么，交易没有“看到”前一个交易，我们的意思是什么？在模型中，我们使每个交易在到达后的一段时间内不可见。我们用字母h标记这个延迟期。此延迟表示交易准备和通过网络传播所需的时间。在我们的模拟中，我们总是设置h = 1。这意味着我们只能批准过去至少一个时间单位的交易。这种延迟不仅仅是为了获得额外的真实感而带来的细微细节，而是纠结的基本属性，没有它我们总会得到一个非常无聊的链条。它还使纠结更接近现实世界，人们需要一些时间来告诉对方新的交易。

### _随机游走_

最后，是时候讨论更高级的提示选择算法：未加权随机游走。使用这个算法，我们在创世交易中放置一个walker，让它开始“走向”提示。在每一步中，它跳转到直接批准我们当前所在的交易之一。我们选择以相同的概率跳转到哪个交易，这是术语未加权来自的地方。这是一个[**模拟**][11] ** **，显示了这是如何发生的。

![][17]

未加权随机游走

您可以看到助行器跟随的路径标记为红色，并且在每个交叉点处，不同的可能路径标记为蓝色。对当前随机游走“不可见”的最近交易显示为透明的。

### 加权随机游走和C竞争游走

让我们从研究它的动机开始。我们希望我们的提示选择算法要做的一件事是避免_lazy tips_。懒惰的提示是批准旧交易而不是最近交易的交易。它是懒惰的，因为它不打扰最新状态的缠结，并且只根据旧数据广播自己的交易。这对网络没有帮助，因为没有确认新的交易。

![][19]

未加权随机游走

在上面的示例中，交易14是一个惰性提示，它批准了一些非常旧的交易。如果我们使用统一随机提示选择算法，交易14就像其他任何一个一样被批准，所以它根本不会受到惩罚。使用未加权的步行，甚至鼓励这种不良行为，至少在之前的模拟中是这样。

我们该如何处理这个问题？我们不能做的一件事是强迫参与者只批准最近的交易，因为这会与权力下放的想法发生冲突。交易可以批准任何他们喜欢的人。我们也没有可靠的方法来确切说明每笔交易何时进入，因此我们无法执行此类规则。我们的解决方案是构建我们的系统，内置针对此类行为的激励措施，以便懒惰的提示不太可能得到任何人的批准。

我们的策略是偏心我们的随机游走，所以我们不太可能选择懒惰的提示。我们将使用术语累计权重来表示交易的重要性。我们更有可能走向繁重的交易，而不是轻松的交易。累积权重的定义非常简单：我们计算交易有多少批准者，并添加一个。我们统计直接和间接审批人。在下面的示例中，交易3的累计权重为5，因为它有四个批准它的交易（直接5个;间接为7个，8个和10个）。

![][21]

具有_累积权重的加权随机游走_

为什么这样做？让我们来看看另一个懒惰的提示情况。在下面的示例中，交易16是一个懒惰的提示。为了使16获得批准，随机漫步者必须达到交易7，然后在交易9上选择交易16.但这不太可能发生，因为交易16的累积权重为1，而交易9的累积权重为7！这是阻止懒惰行为的有效方法。

![][23]

加权随机游走（激励非懒惰技巧）

此时我们可能会问：我们是否需要随机性？我们可以发明超级权重的随机游走，在每个交汇点我们选择最重的交易，没有涉及概率。然后我们会得到这样的东西：

![][25]

超加权步行。我们总是走向最繁重的交易

灰色方块是提示，零审批者。虽然在图表的右端有一些提示是正常的，但是看到很多这些提示在时间轴上分散是一个问题。这些提示是左后面的交易，永远不会被批准。这是让我们走得太多的不利因素：如果我们坚持只选择任何给定点上最重的交易，那么很大一部分提示永远不会得到批准。我们只留下了批准交易的中央走廊，以及在场外被遗忘的提示。

我们需要一种方法来定义我们走向给定交叉点的任何特定审批者的可能性。我们选择的确切公式并不重要，只要我们对较重的交易给出一些偏见，并且有一个参数来控制这种偏差的强度。这引入了我们的新参数_α_，它设置了交易累积权重的重要性。它的确切定义可以在IOTA的[白皮书][26]中找到，如果有需求，我可以写一篇未来的帖子，提供更多细节。

![][28]

_加权随机游走：每个蓝色交易显示其累积权重，以及被选为步行中下一步的概率._

如果我们将_α_设置为零，我们将回到未加权的步行。如果我们设置_α_非常高，我们得到超加权步行。在这两者之间，我们可以在惩罚懒惰行为和不留下太多技巧之间找到一个很好的平衡点。确定_α_的理想值是IOTA中的一个重要研究课题。

这种设定用于确定随机游走中每个步骤的概率的规则的方法被称为[** _马尔可夫链蒙特卡罗_ **][29]技术或MCMC。在马尔可夫链中，每一步都不依赖于前一步，而是遵循事先决定的规则。

![][31]

与往常一样，我们有[**模拟**][32] ** **来展示这些新想法。我建议玩_α_和λ的值，看看你可以做些什么样的有趣缠结。

### 批准者，余额和双倍支出

到目前为止，我们讨论了DAG，随机游走和各种尖端选择机制;这次我们会谈钱。是时候解释当我们说交易A 批准交易B时我们的意思了。

如上所述，每个交易包含“Alice给bob 10 IOTA”形式的信息。批准者的工作是确保Alice真的第一次给予10个IOTA。

你可能想知道：这些IOTA来自哪里？答案是它们都是在纠结中的第一个交易中创建的，称为创世交易。不会创建额外的IOTA。从起源开始，IOTA被转移到项目中原始投资者的账户中，与他们投入的金额成比例。之后，他们将部分IOTA出售给其他人，最终建立了交易网络。

回到爱丽丝和鲍勃，让我们看一个简单的例子。该框表示交易。为方便起见，我们还在交易发生之前和之后记下Alice和Bob帐户中的余额。我们看到爱丽丝最初有10i，她给了Bob，之后Bob有10i而Alice没有。

![][34]

交易

最后有人，比如查理，想要自己付款。他运行了提示选择算法，结果他需要批准Alice的交易。要做到这一点，他必须验证Alice真的有她花的10i。查理最好认真对待这个任务：如果他批准了一个糟糕的交易，他自己的交易永远不会被批准！

为了绝对肯定，查理必须列出所有由Alice的交易直接和间接批准的交易，一直回到起源。他最终得到一个很长的列表，可能看起来像这样：

1. 创世纪创造了15i
2. 创世纪给鲍勃2i
3. 创世纪给爱丽丝8i
4. 创世纪给了查理5i
5. 查理给了唐娜3i
6. Bob给Alice 2i

这当然只是一种选择;在Alice的帐户中以10i结尾，在Bob的帐户中以0结尾的任何列表都是可以接受的。查理还必须跟踪系统中的所有其他帐户，以确保它们不会低于零：如果“之前”或“之后”部分中的任何余额为负数，则其交易无效。

让我们来看看Alice试图提供比她更多的IOTA的情况：

![][36]

Alice付了鲍勃100i，即使她只有10个。爱丽丝的交易，以及批准它的任何未来交易，被网络视为无效。不允许负余额。

当我们批准两个交易而不是一个交易时，情况会变得更有趣：

![][38]

鲍勃在批准爱丽丝的交易时是正确的，因为她的帐户中有足够的钱来支付两者而不低于零。

如果总数超过她的数量会怎么样？如下所示。在这种情况下，Bob 不能批准Alice的两个交易，因为它们导致Alice的负余额。如果Bob这样做，他就违反了IOTA协议的规则，没有人会批准他的新交易。

![][40]

最后一种情况被称为[**双花**][41]，因为Alice花了她的钱两次。请注意，她没有违反协议，因为她有足够的钱用于每笔交易。也许她甚至不打算花两倍钱，但错误地将她的交易送了两次。然而，她确实在纠结中创造了两个无法调和的分支。这给IOTA的诚实用户带来了问题：他们应该批准哪个分支？

这个问题的解决方案再一次是我们上周学到的加权步行。最终其中一个分支将比另一个分支更重，而较轻的分支将被放弃。这也意味着交易不能被认为是在交易发布后立即确认，即使它有一些批准者，因为它可能是最终将被放弃的分支的一部分。为了确保您的交易得到确认，您必须等待其确认足够高。

### 共识、确认信任和协调员

我们刚刚提到了双花问题，当Alice试图不止一次地花钱时就会出现这种问题。现在，我们将展示如何在Tangle中解决此问题，以及我们如何确定哪个历史记录是有效的。

为了说明问题，我们将研究以下双花费方案：

![][43]

正如你所看到的，Alice有5i，她给了查理和鲍勃。这显然是一个问题：我们不能将这两个交易视为有效。使用Tangle术语，我们不能让未来的交易同时批准它们，因为它最终会在Alice的账户中产生负余额。

我们已经了解到，使用加权随机游走算法，最终其中一个分支将变得更大。因此形成了_consensus_，其中交易是有效的。然而，从鲍勃或查理的角度来看，存在一个问题：他们怎么知道他们是否从爱丽丝那里得到了钱？

想象鲍勃和查理是恐龙经销商，爱丽丝从他们每个人那里购买了宠物T-Rex。如果他们在Tangle看到她的交易后立即将T-Rex送给她，最终其中一人会发现他没有得到报酬。他们怎么知道什么时候运送蜥蜴是安全的？

这是一个严重的问题，事实上，比特币是第一个成功应对它的技术，早在2009年。为了展示Tangle如何解决它，我们引入了一个名为确认信心的概念。这种信心衡量交易的其余纠结程度。

交易的确认置信度计算如下：

1. 运行尖端选择算法100次。
2. 计算这100个技巧中有多少批准我们的交易，并称之为A.
3. 我们交易的确认信心是“百分比”。

换句话说，交易的置信度是批准它的提示的百分比。并非所有提示都被视为平等;更可能的提示更重要。为了说明这一点，让我们为[**模拟**][44]增加确认信心。信心超过95％的交易显示为围绕它们的粗边框。

![][46]

使用确认信心解决双重支出问题

在上面的纠结中，交易9被四个提示中的两个批准。如果我们使用统一的随机提示选择，它将具有恰好50％的置信度。然而，批准它的提示显然比不提示的提示更有可能，这提高了一点信心。

现在很清楚Bob和Charlie如何判断将T-Rex发送给Alice是否安全。一旦Alice的交易达到一个非常高的置信度阈值，比如95％，它就不太可能被推出共识。我们应该小心并且说 - 不太可能，而不是不可能;如果爱丽丝想要作弊，并且有足够的计算能力，她可以尝试双倍花钱。

为此，她将发出支付查理而不是鲍勃的交易。她将不得不批准与它进行两次旧交易，而这些交易并没有将她的付款提交给查理。然后，她将开始尽可能多地发出交易，试图提高她新分支的累积权重。如果她有足够的计算能力，她可以让整个IOTA网络相信她并跟随她的新分支，从而重写历史并成功地进行双重支出。如果我们看看她对Bob的交易的置信水平，我们会看到它从95％下降到最终为零。

这种攻击在下面的纠结中说明，时间向下：

![][48]

双重攻击

如果Alice可以发送比其他所有组合或接近它的更多交易，则此方案只是一种风险。虽然在成熟和活跃的网络中不是主要风险，但对于今天的IOTA来说，这是一个真正的问题。系统没有足够的交易来保证集中的双重花费攻击。

由于IOTA是为扩展而建立的，出于安全原因，我们采用了自愿和临时的不同共识机制：协调员。每两分钟，IOTA基金会发布一次_milestone_交易，并且其认可的所有交易立即被视为具有100％的确认置信度。使用协调员，Alice的第二笔交易将永远不会被批准。这是一种保护机制，而IOTA网络不断发展，必须采取必要的活动，以保持网络安全，保持100％分散的方式，完整的Tangle分布式共识算法启动。此时IOTA基金会将关闭协调员让Tangle完全靠自己进化。这将在迭代阶段发生。当网络足够成熟以摆脱协调器时，网络也将立即变得更加高效。

### 它与区块链有什么不同？

DAG与区块链的不同之处在于它改变了我们存储交易方式的内在结构。这种变化无论多么微小，都会改变我们看到网络中发生的事情的方式。它使整个系统比区块链更加强大。但总有一个问题。可扩展性的增加伴随着安全性的降低，集中化的可能性更大以及无法固有地支持智能合约。我们将在下一篇文章中讨论有关区块链与DAG的更多信息。敬请关注！

[1]: https://en.wikipedia.org/wiki/Directed_graph
[2]: https://cdn-images-1.medium.com/freeze/max/75/0*ugPaad_14ESxwsPi.?q=20
[3]: https://cdn-images-1.medium.com/max/2000/0*ugPaad_14ESxwsPi.
[4]: https://public-rdsdavdrpd.now.sh/
[5]: https://cdn-images-1.medium.com/freeze/max/75/1*H8xoyZN5ESR1_FWa1xijEQ.gif?q=20
[6]: https://hackernoon.com/undefined
[7]: https://cdn-images-1.medium.com/max/2000/1*H8xoyZN5ESR1_FWa1xijEQ.gif
[8]: https://en.wikipedia.org/wiki/Poisson_point_process
[9]: https://cdn-images-1.medium.com/freeze/max/75/0*Ky8YrqUebNcgDFmk.?q=20
[10]: https://cdn-images-1.medium.com/max/2000/0*Ky8YrqUebNcgDFmk.
[11]: https://public-xnmzdqumwy.now.sh/
[12]: https://cdn-images-1.medium.com/freeze/max/75/0*9nJP7-qMCHm8jXLm.?q=20
[13]: https://cdn-images-1.medium.com/max/2000/0*9nJP7-qMCHm8jXLm.
[14]: https://cdn-images-1.medium.com/freeze/max/75/0*mtdodISa6aBjqyR1.?q=20
[15]: https://cdn-images-1.medium.com/max/2000/0*mtdodISa6aBjqyR1.
[16]: https://cdn-images-1.medium.com/freeze/max/75/1*1vdLkM4u7juZDTIq2CMslQ.gif?q=20
[17]: https://cdn-images-1.medium.com/max/2000/1*1vdLkM4u7juZDTIq2CMslQ.gif
[18]: https://cdn-images-1.medium.com/freeze/max/75/0*-BUE4CNQNSl8nNby.?q=20
[19]: https://cdn-images-1.medium.com/max/2000/0*-BUE4CNQNSl8nNby.
[20]: https://cdn-images-1.medium.com/freeze/max/75/0*pIhgmSHYjYwEA-St.?q=20
[21]: https://cdn-images-1.medium.com/max/2000/0*pIhgmSHYjYwEA-St.
[22]: https://cdn-images-1.medium.com/freeze/max/75/0*5hzv8meXLLWeKuGm.?q=20
[23]: https://cdn-images-1.medium.com/max/2000/0*5hzv8meXLLWeKuGm.
[24]: https://cdn-images-1.medium.com/freeze/max/75/0*PqjubcCEQqN2FCwT.?q=20
[25]: https://cdn-images-1.medium.com/max/2000/0*PqjubcCEQqN2FCwT.
[26]: https://iota.readme.io/docs/whitepaper
[27]: https://cdn-images-1.medium.com/freeze/max/75/1*Le0N_rKh7NrR-7z9y9UTxg.png?q=20
[28]: https://cdn-images-1.medium.com/max/2000/1*Le0N_rKh7NrR-7z9y9UTxg.png
[29]: https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo
[30]: https://cdn-images-1.medium.com/freeze/max/75/0*ENA8_G-dPuAhB-ND.?q=20
[31]: https://cdn-images-1.medium.com/max/2000/0*ENA8_G-dPuAhB-ND.
[32]: https://public-qnbiiqwyqj.now.sh/
[33]: https://cdn-images-1.medium.com/freeze/max/75/0*KTZmL34g8hs_mxRh.?q=20
[34]: https://cdn-images-1.medium.com/max/2000/0*KTZmL34g8hs_mxRh.
[35]: https://cdn-images-1.medium.com/freeze/max/75/0*YmTT-yxnS6iavDYe.?q=20
[36]: https://cdn-images-1.medium.com/max/2000/0*YmTT-yxnS6iavDYe.
[37]: https://cdn-images-1.medium.com/freeze/max/75/0*hf8SqUxjoiA254er.?q=20
[38]: https://cdn-images-1.medium.com/max/2000/0*hf8SqUxjoiA254er.
[39]: https://cdn-images-1.medium.com/freeze/max/75/0*_PX0hC-SVYdMgBDs.?q=20
[40]: https://cdn-images-1.medium.com/max/2000/0*_PX0hC-SVYdMgBDs.
[41]: https://en.wikipedia.org/wiki/Double-spending
[42]: https://cdn-images-1.medium.com/freeze/max/75/0*hu_bY4iSNNPWBpS1.?q=20
[43]: https://cdn-images-1.medium.com/max/2000/0*hu_bY4iSNNPWBpS1.
[44]: https://public-krwdbaytsx.now.sh
[45]: https://cdn-images-1.medium.com/freeze/max/75/0*uhiAGN6uJ6a_pB1F.?q=20
[46]: https://cdn-images-1.medium.com/max/2000/0*uhiAGN6uJ6a_pB1F.
[47]: https://cdn-images-1.medium.com/freeze/max/75/1*zf8LxIx88dZTj2YIHl9T0w.png?q=20
[48]: https://cdn-images-1.medium.com/max/2000/1*zf8LxIx88dZTj2YIHl9T0w.png



#### 区块链中文字幕组

致力于前沿区块链知识和信息的传播，为中国融入全球区块链世界贡献一份力量。

如果您懂一些技术、懂一些英文，欢迎加入我们，加微信号:w1791520555。

[点击查看项目GITHUB，及更多的译文...](https://github.com/BlockchainTranslator/EOS)

#### 本文译者简介

小丹 区块链技术爱好者  热衷于区块链底层技术研究

版权所有，转载需完整注明以上内容。

----------------------------------------------------
